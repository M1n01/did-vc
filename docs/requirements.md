# Trust Rails – 要件定義 v0.1 (Draft)

> **目的** : チーム内ディスカッションのたたき台として、現時点で想定している機能・非機能要件を網羅的に整理する。

---

## 1. サービス概要

### 1.1 目的・ビジョン

* **ミッション** : DID / VC ベースの "パスワードレス & プライバシー指向" 認証インフラを提供し、ユーザーとサービス間の信頼コストをゼロにする。
* **バリュープロポジション** :

  1. Passkey + モバイルウォレット UX により、登録を "3 タップ・10 秒"、ログインを "1 タップ・3 秒" で完結。
  2. Issuer ⇄ Verifier を相互接続する API レイヤ (Trust Rails Hub) を提供し、1 度発行した VC が複数サービスで再利用可能。
  3. 規制・監査 (AML / GDPR / eIDAS 2.0) をプラットフォーム側で肩代わりし、開発者負担を最小化。

### 1.2 想定ユースケース

| ユースケース         | 説明                          | 付加価値                     |
| -------------- | --------------------------- | ------------------------ |
| Webサービスのログイン   | SNS / EC / SaaS でのアカウントレス認証 | パスワード廃止・ボット排除            |
| 年齢確認 (R18/R20) | 酒・タバコ EC / ゲーム課金            | 1 click 年齢証明・改ざん防止       |
| KYC / KYB      | FinTech・証券口座開設              | 再利用可能な eKYC VC を API で検証 |
| イベント入場         | オンチェーン NFT チケット + VC        | 不正転売対策・来場データ連携           |

---

## 2. ターゲットユーザー

### 2.1 ペルソナ

1. **End User – 佐藤 健 (20)**

   * 特徴 : Webサービスの学割を利用しているが、毎回身分証をアップロードするのが面倒
   * ニーズ : ワンタップで安全にログイン・本人確認したい
2. **DevOps Engineer – 鈴木 悠 (32)**

   * 特徴 : Web SaaS を運営。Auth0 のコスト増に悩む
   * ニーズ : 5 分で導入でき、SLA がある認証 API
3. **Compliance Officer – 田中 葵 (40)**

   * 特徴 : 金融機関の KYC 担当
   * ニーズ : 監査証跡とレポートを自動出力する仕組み
4. **Engineer - 阿部 寛 (27)**

   * 特徴 : 個人開発をしており、Web2.0 の認証システムに問題意識を持つ
   * ニーズ : 安全でシンプルな認証システムを探している

### 2.2 ペインポイント

* パスワード漏えい・リセットコスト
* サービス毎に KYC を繰返す UX 劣化
* 事業者側の規制対応負担 (AML / 個人情報保護)

---

## 3. 機能要件

### 3.1 コア機能 (Must)

| ID   | 機能               | 説明                                | API / UI             |
| ---- | ---------------- | --------------------------------- | -------------------- |
| F‑01 | DID 生成           | Passkey から did\:key / did\:tr を生成 | SDK only             |
| F‑02 | VC 発行 (OIDC4VCI) | Issuer API ⇄ Trust Rails Hub      | REST / Admin UI      |
| F‑03 | VC 検証            | `/verify` エンドポイント (JWT / JSON‑LD) | REST                 |
| F‑04 | パスワードレス認証        | Challenge → VP 署名 → Session       | SDK + Cookie / Token |
| F‑05 | プロフィール管理         | 発行済 VC 一覧・共有設定                    | Web /Mobile UI       |

### 3.2 オプション機能 (Should/Could)

| ID   | 機能                                  | 優先度 |
| ---- | ----------------------------------- | --- |
| O‑01 | VC 共有リンク (Deep Link + QR)           | S   |
| O‑02 | 秘密鍵リカバリ (Shamir + Passkey Rotation) | S   |
| O‑03 | 外部 ID プロバイダ連携 (OAuth 2.0 Bridge)    | C   |

---

## 4. 非機能要件

| 区分       | 指標                        | 目標値                       |
| -------- | ------------------------- | ------------------------- |
| セキュリティ   | WebAuthn L3 相当 / FAPI 1.0 | 準拠必須                      |
| パフォーマンス  | `/verify` レスポンス           | < 200 ms (p95, JP Region) |
| 可用性      | サーバ API                   | 99.9 % / 月                |
| スケーラビリティ | 同時 Verify RPS             | 1,000 req/s 横方向スケール       |
| プライバシー   | 個人データ保持期間                 | 最短 30 日 (VC 指紋のみ保持)       |
| コンプライアンス | ISO 27001 / SOC2 Type II  | 12 か月以内取得                 |

---

## 5. 認証・認可フロー

1. **初回オンボーディング**

   1. Passkey 作成 → DID 登録
   2. Issuer OIDC Flow で VC 取得
   3. VP 署名しセッション確立
2. **再ログイン**

   1. Challenge 取得
   2. Passkey → VP 署名 → Session Refresh
3. **VC 検証**

   1. Client → Trust Rails `/verify`
   2. Revocation & Registry Check (<10 ms cache)
   3. JSON 結果返却 (valid, risk\_score)

---

## 6. 外部連携・依存サービス

| 種別                 | 候補                          | 目的             |
| ------------------ | --------------------------- | -------------- |
| KYC Provider       | TRUSTDOCK, DeepScore        | VC 発行用 eKYC    |
| Passkey / WebAuthn | iOS / Android / Chrome API  | 鍵生成・署名         |
| Blockchain (L2)    | Polygon CDK or Base         | VC ハッシュタイムスタンプ |
| Cloud              | AWS (Edge Lambda, DynamoDB) | API / DB 基盤    |

---

## 7. UI / UX 要件

* **ログイン UI** : OS ネイティブ Passkey ダイアログ呼び出し。フォールバックに QR コード。
* **VC 管理画面** : 発行 VC カード表示、失効ステータスを色分け。
* **説明 / 同意** : 初回のみ GDPR 準拠の同意チェックボックス、プライバシーポリシーリンク。

---

## 8. 開発・運用体制 (初期)

| 役割          | 人数          | 主担当                |
| ----------- | ----------- | ------------------ |
| プロダクトオーナー   | 1           | ビジョン・優先度決定         |
| プロトコルエンジニア  | 1           | DID/VC 実装・RFC フォロー |
| フルスタックエンジニア | 2 (42Tokyo) | SDK & API 開発       |
| DevSecOps   | 1 (外部委託)    | CI/CD・監査ログ・IaC     |
| Biz/規制リード   | 1           | 助成金・AML 対応・契約      |

運用方針 : 24/7 PagerDuty オンコール (PoC 期間は 9–21 時)・CloudWatch + Sentry 監視。

---

## 9. マイルストーン

| フェーズ     | 期限         | 完了条件                         |
| -------- | ---------- | ---------------------------- |
| PoC v0   | T0 + 2 か月  | `/verify` デモ / LOI × 2       |
| Alpha v1 | T0 + 4 か月  | Issuer 1社・End User 100 名     |
| Beta v2  | T0 + 8 か月  | RPS 100・SLA 99.5 %           |
| GA v3    | T0 + 12 か月 | 3 Issuer / 10 k MAU / 99.9 % |

---

## 10. 既知の課題 & 次回議題

* 秘密鍵リカバリ UX 詳細
* Revocation List 形式 (StatusList v1 vs v2)
* リスクスコアリングの重み付けモデル

---

*Draft generated : 2025‑05‑19*
